<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
    crossorigin="anonymous"
  />

  <title>Recuperar Senha - NotaDez</title>

  <link rel="stylesheet" href="/public/base-cad-log.css" />
</head>

<body>
  <main class="container py-5 d-flex justify-content-center align-items-center">
    <form class="w-100" style="max-width: 400px;" id="form-recuperar">
      <h1 class="mb-4 text-center">Recuperar Senha</h1>
      
      <div class="mb-3" id="email-group">
        <label for="email-recuperar" class="form-label">Email</label>
        <input type="email" class="form-control" id="email-recuperar" placeholder="Digite o email cadastrado" required/>
      </div>

      <p id="mensagem-codigo" class="text-center text-success d-none">O código foi enviado para o seu e-mail.</p>

      <div class="mb-4 d-none" id="codigo-group">
        <label for="codigo-verificacao" class="form-label">Código de Verificação</label>
        <input type="text" class="form-control" id="codigo-verificacao" placeholder="Digite o código recebido" maxlength="7"/>
      </div>

      <div class="d-grid gap-2 d-md-flex justify-content-md-end">
        <a href="/" type="button" class="btn btn-light mb-3">Voltar</a>
        <button type="submit" id="btn-enviar-email" class="btn btn-primary mb-3">Enviar</button>
        <button type="submit" id="btn-verificar-codigo" class="btn btn-primary mb-3 d-none">Verificar Código</button>
      </div>
    </form>
  </main>

  <script>
    // Seleciona os elementos do formulário
    const form = document.getElementById('form-recuperar');
    const emailInput = document.getElementById('email-recuperar');
    const codigoGroup = document.getElementById('codigo-group');
    const codigoInput = document.getElementById('codigo-verificacao'); // Seleciona o input do código
    const mensagemCodigo = document.getElementById('mensagem-codigo');
    const btnEnviarEmail = document.getElementById('btn-enviar-email');
    const btnVerificarCodigo = document.getElementById('btn-verificar-codigo');

    // Gerar Código para autenticação
    const codigo = {
    value: '',
    length: 7,
    characters: {
    numbers: '0123456789',
    lowercase:'abcdefghijklmnopqrstuvwxyz',
    uppercase: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
    },

      gerar(chars){
        // Se houver código, retornar o código já gerado
        if (this.value) {
          return this.value; 
        }

        // Gerar código
        let gen = '';

        this.length = this.length < 5 || this.length > 50 ? 15 : this.length

        chars = chars || Object.values(this.characters).join('');

        for (let i = 0; i < this.length; i++){
            gen += chars[Math.floor(Math.random() * chars.length)]
        }
        this.value = gen;
        return gen;
      }
      
    };

    form.addEventListener('submit', function(event) {
      event.preventDefault();

      if (!btnEnviarEmail.classList.contains('d-none')) {
        // --- Etapa 1: Enviar o Email ---
        console.log('Simulando envio de código para:', emailInput.value);
        
        // Atualiza a interface
        emailInput.disabled = true;
        btnEnviarEmail.classList.add('d-none'); 
        
        mensagemCodigo.classList.remove('d-none');
        codigoGroup.classList.remove('d-none');
        btnVerificarCodigo.classList.remove('d-none');
        
        // ADIÇÃO: Torna o campo de código obrigatório AGORA que está visível
        codigoInput.required = true;
        
        // Gera o código
        codigo.gerar();

        // Simular valores de código
        alert('Código gerado: ' + codigo.value);
        console.log('Simulando verificação do código:', codigo.value);

      } else {
        const codigoDigitado = codigoInput.value;  // valor do input do usuário
        const codigoGerado = codigo.value;         // código gerado e armazenado

        if (codigoDigitado === codigoGerado) {
          alert('Código verificado com sucesso!');
        } else {
          alert('Código incorreto, tente novamente.');
        }
      }
    });
  </script>
</body>
</html>