<!-- Desenvolvido por Murillo Iamarino Caravita-->

<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Link do Bootstrap -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
    crossorigin="anonymous"
  />

  <title>Cadastro NotaDez</title>

  <!-- Conectando o CSS personalizado -->
  <link rel="stylesheet" href="/public/base-cad-log.css" />
</head>

<body>
  <main class="container py-5 d-flex justify-content-center align-items-center">
    <form id="form-cadastro" class="w-100" style="max-width: 400px;">
      <h1 class="mb-4 text-center">NotaDez Cadastro</h1>
      
      <div class="mb-3">
        <label for="nome-cadastro" class="form-label">Nome Completo*</label>
        <input type="text" class="form-control" id="nome-cadastro" placeholder="Digite seu o nome completo" required/>
      </div>

      <div class="mb-3">
        <label for="email-cadastro" class="form-label">Email *</label>
        <input type="email" class="form-control" id="email-cadastro" placeholder="Digite seu email" required/>
      </div>

      <div class="mb-3">
        <label for="telefone-cadastro" class="form-label">Telefone *</label>
        <input type="tel" class="form-control" id="telefone-cadastro" placeholder="(xx) xxxxx-xxxx" required maxlength="15"  title="Digite o telefone no formato (XX) XXXXX-XXXX" />

      </div>

      <div class="mb-4">
        <label for="senha-cadastro" class="form-label">Senha *</label>
        <input type="password" class="form-control" id="senha-cadastro" placeholder="Digite a senha" required minlength="6" />
      </div>

      <div class="mb-4">
        <label for="conf-senha-cadastro" class="form-label">Confirmar Senha *</label>
        <input type="password" class="form-control" id="conf-senha-cadastro" placeholder="Digite a senha" required/>
      </div>

    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
        <a href="/" type="button" id="voltar" class="btn btn-light mb-3">Voltar </a>
        <button type="submit" id="EntrarLogin" class="btn btn-primary mb-3">Cadastrar</button>
    </div>

    </form>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('form-cadastro');
        const telefone = document.getElementById('telefone-cadastro');
        const senha = document.getElementById('senha-cadastro');
        const confSenha = document.getElementById('conf-senha-cadastro');

        form.addEventListener('submit', async function (e) {
          e.preventDefault(); // evita envio padrão do formulário

          // Validação: senha mínima 6 caracteres
          if (!senha.value || senha.value.length < 6) {
            senha.classList.add('is-invalid');
            if (!document.getElementById('senha-length-feedback')) {
              const feedback = document.createElement('div');
              feedback.className = 'invalid-feedback';
              feedback.id = 'senha-length-feedback';
              feedback.textContent = 'A senha deve ter pelo menos 6 caracteres.';
              senha.parentNode.appendChild(feedback);
            }
            senha.focus();
            return;
          }
          senha.classList.remove('is-invalid');
          const feedbackLen = document.getElementById('senha-length-feedback');
          if (feedbackLen) feedbackLen.remove();

          // Validação de senha (confirmação)
          if (senha.value !== confSenha.value) {
            confSenha.classList.add('is-invalid');
            if (!document.getElementById('senha-mismatch-feedback')) {
              const feedback = document.createElement('div');
              feedback.className = 'invalid-feedback';
              feedback.id = 'senha-mismatch-feedback';
              feedback.textContent = 'Senhas diferentes';
              confSenha.parentNode.appendChild(feedback);
            }
            confSenha.focus();
            return;
          }

          confSenha.classList.remove('is-invalid');
          const feedback = document.getElementById('senha-mismatch-feedback');
          if (feedback) feedback.remove();
          
          // Validação do telefone
          const telefoneRegex = /^\(?\d{2}\)?\s?\d{4,5}-?\d{4}$/;
            if (!telefoneRegex.test(telefone.value)) {
              telefone.classList.add('is-invalid');
              if (!document.getElementById('telefone-feedback')) {
                const feedbackTel = document.createElement('div');
                feedbackTel.className = 'invalid-feedback';
                feedbackTel.id = 'telefone-feedback';
                feedbackTel.textContent = 'Telefone inválido. Insira um formato válido.';
                telefone.parentNode.appendChild(feedbackTel);
              }
              telefone.focus();
              return;
            }
          telefone.classList.remove('is-invalid');
          const feedbackTel = document.getElementById('telefone-feedback');
          if (feedbackTel) feedbackTel.remove();

          // Dados do formulário
          const data = {
            nome: document.getElementById('nome-cadastro').value,
            email: document.getElementById('email-cadastro').value,
            celular: document.getElementById('telefone-cadastro').value,
            senha: senha.value
          };

          try {
            const response = await fetch('cadastrar', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });


            const result = await response.json();

            if (response.ok) {
              alert(result.message); // ou redireciona para login
              form.reset();
              window.location.href = '/'; // se quiser redirecionar
            } else {
              alert(result.message);
            }

          } catch (err) {
            console.error(err);
            alert('Erro ao cadastrar. Tente novamente mais tarde.');
          }
        });
      });
  </script>

  </main>
</body>
</html>