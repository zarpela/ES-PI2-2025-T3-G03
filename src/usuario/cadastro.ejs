<!-- Desenvolvido por Murillo -->

<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Link do Bootstrap -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
    crossorigin="anonymous"
  />

  <title>Cadastro NotaDez</title>

  <!-- Conectando o CSS personalizado -->
  <link rel="stylesheet" href="/public/base-cad-log.css" />
</head>

<body>
  <main class="container py-5 d-flex justify-content-center align-items-center">
    <form class="w-100" style="max-width: 400px;">
      <h1 class="mb-4 text-center">NotaDez Cadastro</h1>
      
      <div class="mb-3">
        <label for="nome-cadastro" class="form-label">Nome *</label>
        <input type="text" class="form-control" id="nome-cadastro" placeholder="Digite seu o nome completo" required/>
      </div>

      <div class="mb-3">
        <label for="email-cadastro" class="form-label">Email *</label>
        <input type="email" class="form-control" id="email-cadastro" placeholder="Digite seu email" required/>
      </div>

      <div class="mb-3">
        <label for="telefone-cadastro" class="form-label">Telefone *</label>
        <input type="tel" class="form-control" id="telefone-cadastro" placeholder="(xx) xxxxx-xxxx" required pattern="\(\d{2}\)\s?\d{4,5}-\d{4}"  maxlength="15"  title="Digite o telefone no formato (XX) XXXXX-XXXX" />
      </div>

      <div class="mb-4">
        <label for="senha-cadastro" class="form-label">Senha *</label>
        <input type="password" class="form-control" id="senha-cadastro" placeholder="Digite a senha" required/>
      </div>

      <div class="mb-4">
        <label for="conf-senha-cadastro" class="form-label">Confirmar Senha *</label>
        <input type="password" class="form-control" id="conf-senha-cadastro" placeholder="Digite a senha" required/>
      </div>

    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
        <a href="/" type="button" id="voltar" class="btn btn-light mb-3">Voltar </a>
        <button type="submit" id="EntrarLogin" class="btn btn-primary mb-3">Cadastrar</button>
    </div>

    </form>

    <script>

      document.addEventListener('DOMContentLoaded', function () {
      const form = document.querySelector('form');
      const senha = document.getElementById('senha-cadastro');
      const confSenha = document.getElementById('conf-senha-cadastro');

      // Evento de validação de senha, caso esteja errado muda a orda para vermelha.

      form.addEventListener('submit', function (e) {
        if (senha.value !== confSenha.value) {
          // Impede o envio do formulário
          e.preventDefault();
          confSenha.classList.add('is-invalid');
          if (!document.getElementById('senha-mismatch-feedback')) {
            const feedback = document.createElement('div');
            feedback.className = 'invalid-feedback';
            feedback.id = 'senha-mismatch-feedback';
            feedback.textContent = 'Senhas diferentes';
            confSenha.parentNode.appendChild(feedback);
          }
          confSenha.focus();
        } else {
          confSenha.classList.remove('is-invalid');
          const feedback = document.getElementById('senha-mismatch-feedback');
          if (feedback) feedback.remove();

          // Dados do formulário
          const data = {
            nome: document.getElementById('nome-cadastro').value,
            email: document.getElementById('email-cadastro').value,
            celular: document.getElementById('telefone-cadastro').value,
            senha: senha.value
          };

          try {
            const response = await fetch('usuario/cadastro', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });


            const result = await response.json();

            if (response.ok) {
              alert(result.message); // ou redireciona para login
              form.reset();
              window.location.href = '/login'; // se quiser redirecionar
            } else {
              alert(result.message);
            }

          } catch (err) {
            console.error(err);
            alert('Erro ao cadastrar. Tente novamente mais tarde.');
          }
        });
      });
  </script>

  </main>
</body>
</html>